import os
import telebot
import random
import time
import json
from datetime import datetime, timedelta

# --- Настройки ---
BOT_TOKEN = os.getenv("BOT_TOKEN") or os.getenv("TELEGRAM_TOKEN")
CHANNEL_ID = os.getenv("CHANNEL_ID")  # "@my_channel" или "-1001234567890"
SLEEP_SECONDS = int(os.getenv("SLEEP_SECONDS", "180"))  # пауза между постами (сек)
HISTORY_FILE = "used_combinations.json"
HISTORY_DAYS = int(os.getenv("HISTORY_DAYS", "30"))

if not BOT_TOKEN:
    raise SystemExit("❌ Ошибка: переменная окружения BOT_TOKEN (или TELEGRAM_TOKEN) не задана.")
if not CHANNEL_ID:
    raise SystemExit("❌ Ошибка: переменная окружения CHANNEL_ID не задана.")

bot = telebot.TeleBot(BOT_TOKEN)

# --- Месяцы для русского формата даты ---
MONTHS = {
    1: "января", 2: "февраля", 3: "марта", 4: "апреля",
    5: "мая", 6: "июня", 7: "июля", 8: "августа",
    9: "сентября", 10: "октября", 11: "ноября", 12: "декабря"
}

# --- Колода Таро (78 карт) ---
tarot_cards = [
    "Шут — новые начинания, свобода", "Маг — сила воли, мастерство", "Верховная Жрица — интуиция, тайны",
    "Императрица — изобилие, забота", "Император — порядок, власть", "Иерофант — традиции, обучение",
    "Влюблённые — выбор, гармония", "Колесница — движение, победа", "Сила — внутренняя стойкость, мужество",
    "Отшельник — поиск истины, уединение", "Колесо Фортуны — перемены, судьба", "Справедливость — баланс, честность",
    "Повешенный — переоценка, новые взгляды", "Смерть — трансформация, конец и начало", "Умеренность — гармония, терпение",
    "Дьявол — искушения, зависимости", "Башня — разрушение, освобождение", "Звезда — надежда, вдохновение",
    "Луна — иллюзии, сны", "Солнце — радость, успех", "Суд — пробуждение, возрождение", "Мир — завершение, целостность",
    # Жезлы
    "Туз Жезлов — энергия, возможности", "Двойка Жезлов — планирование, выбор", "Тройка Жезлов — ожидания, перспективы",
    "Четвёрка Жезлов — праздник, стабильность", "Пятёрка Жезлов — конкуренция, вызов", "Шестёрка Жезлов — победа, признание",
    "Семёрка Жезлов — защита, упорство", "Восьмёрка Жезлов — скорость, новости", "Девятка Жезлов — стойкость, напряжение",
    "Десятка Жезлов — тяжесть, ответственность", "Паж Жезлов — энтузиазм, начало", "Рыцарь Жезлов — решимость, движение",
    "Королева Жезлов — уверенность, вдохновение", "Король Жезлов — лидерство, сила",
    # Кубки
    "Туз Кубков — эмоции, любовь", "Двойка Кубков — союз, партнерство", "Тройка Кубков — радость, друзья",
    "Четвёрка Кубков — скука, недовольство", "Пятёрка Кубков — разочарование, потеря", "Шестёрка Кубков — воспоминания, прошлое",
    "Семёрка Кубков — иллюзии, выбор", "Восьмёрка Кубков — уход, поиск смысла", "Девятка Кубков — удовольствие, исполнение",
    "Десятка Кубков — гармония, семья", "Паж Кубков — вдохновение, чувства", "Рыцарь Кубков — романтика, мечты",
    "Королева Кубков — сострадание, чувствительность", "Король Кубков — зрелость, баланс",
    # Мечи
    "Туз Мечей — истина, ясность", "Двойка Мечей — выбор, сомнения", "Тройка Мечей — боль, разрыв",
    "Четвёрка Мечей — отдых, восстановление", "Пятёрка Мечей — конфликт, поражение", "Шестёрка Мечей — движение вперёд",
    "Семёрка Мечей — хитрость, осторожность", "Восьмёрка Мечей — ограничения, страх", "Девятка Мечей — тревога, кошмары",
    "Десятка Мечей — конец, поражение", "Паж Мечей — любопытство, идеи", "Рыцарь Мечей — напор, импульс",
    "Королева Мечей — мудрость, независимость", "Король Мечей — рассудительность, логика",
    # Пентакли
    "Туз Пентаклей — возможности, материальные блага", "Двойка Пентаклей — баланс, адаптация", "Тройка Пентаклей — сотрудничество",
    "Четвёрка Пентаклей — удержание, контроль", "Пятёрка Пентаклей — трудности, лишения", "Шестёрка Пентаклей — помощь, щедрость",
    "Семёрка Пентаклей — терпение, ожидание", "Восьмёрка Пентаклей — работа, мастерство", "Девятка Пентаклей — успех, самодостаточность",
    "Десятка Пентаклей — богатство, семья", "Паж Пентаклей — учеба, практичность", "Рыцарь Пентаклей — надёжность, трудолюбие",
    "Королева Пентаклей — забота, уют", "Король Пентаклей — стабильность, достаток"
]

# --- Знаки и совместимость ---
signs = [
    "♈️ Овен", "♉️ Телец", "♊️ Близнецы", "♋️ Рак",
    "♌️ Лев", "♍️ Дева", "♎️ Весы", "♏️ Скорпион",
    "♐️ Стрелец", "♑️ Козерог", "♒️ Водолей", "♓️ Рыбы"
]

compatibility = {
    "Овен": "Лев, Стрелец", "Телец": "Дева, Козерог", "Близнецы": "Весы, Водолей",
    "Рак": "Скорпион, Рыбы", "Лев": "Овен, Стрелец", "Дева": "Телец, Козерог",
    "Весы": "Близнецы, Водолей", "Скорпион": "Рак, Рыбы", "Стрелец": "Овен, Лев",
    "Козерог": "Телец, Дева", "Водолей": "Близнецы, Весы", "Рыбы": "Рак, Скорпион"
}

focus_options = [
    "Эмоциональная глубина", "Финансовая стабильность", "Творческое самовыражение",
    "Общение и связи", "Семейное благополучие", "Личностный рост",
    "Духовный поиск", "Физическая активность", "Профессиональный успех",
    "Внутренний баланс", "Отношения и дружба", "Смелые решения"
]

predictions = [
    "Сегодня можно лениться и при этом чувствовать себя гением.",
"Лучшее решение — улыбнуться неожиданным событиям вокруг.",
"Сегодня маленькие радости ценнее больших побед.",
"Вас ждёт день лёгких решений и приятных неожиданностей.",
"Сегодня лучше доверять интуиции, даже если логика против.",
"Маленькие ошибки сегодня превращаются в забавные открытия.",
"Сегодня идеально наблюдать, а не вмешиваться в события.",
"Не торопитесь, день сам предложит подходящий момент.",
"Сегодня можно позволить себе быть немного странным.",
"Лучше всего сегодня — делать меньше и наслаждаться процессом.",
"Сегодня день для лёгких шалостей и радостных моментов.",
"Случайные встречи принесут необычные идеи и вдохновение.",
"Сегодня хорошо пересмотреть старые планы и уточнить цели.",
"Ваши идеи найдут поддержку, если делиться с правильными людьми.",
"Сегодня можно просто слушать, а не спорить.",
"Маленькая пауза принесёт ясность и новые перспективы.",
"Сегодня день для случайных радостей и мелких удовольствий.",
"Лучшее решение — видеть возможность даже в неудаче.",
"Сегодня легко находить общий язык с окружающими.",
"Планы могут измениться, но это принесёт новые возможности.",
"Сегодня идеально для творчества и экспериментов с новыми идеями.",
"Сосредоточенность на простых вещах принесёт внутренний комфорт.",
"Сегодня лучше не торопиться и наслаждаться моментом.",
"Малые шаги сегодня ведут к большим результатам.",
"Сегодня можно позволить себе безделье и получать удовольствие.",
"Лёгкая ирония над собой поможет сохранить спокойствие.",
"Сегодня день для приятных неожиданностей и случайных открытий.",
"Важно слушать себя, а не только мнение других.",
"Сегодня легко находить радость в обыденных делах.",
"Любая мелочь сегодня воспринимается как маленькая победа.",
"Сегодня стоит довериться случайностям и внутреннему голосу.",
"Пусть маленькие трудности превратятся в забавные истории.",
"Сегодня день для наблюдений и лёгкой философии.",
"Лучше всего сегодня — не торопиться и делать шаги медленно.",
"Сегодня можно порадовать себя простыми удовольствиями.",
"В неожиданных моментах кроется ваша польза и успех.",
"Сегодня день для смелых решений и неожиданных поворотов.",
"Малые радости сегодня ценнее больших планов.",
"Сегодня легко заметить мелочи, которые делают день особенным.",
"Лучшее решение — принимать события такими, какие они есть.",
"Сегодня день для творчества, идей и вдохновения.",
"Случайные встречи могут открыть новые горизонты.",
"Сегодня лучше доверять себе и своим ощущениям.",
"Малые ошибки сегодня будут полезными уроками.",
"Сегодня день для простых радостей и лёгкой философии.",
"Лучшее решение — улыбаться и сохранять внутренний покой.",
"Сегодня можно быть немного ленивым и гордиться этим.",
"Сегодня день для маленьких шалостей и больших удовольствий.",
"Сосредоточенность на настоящем принесёт ясность и гармонию.",
"Сегодня лучше наблюдать за миром, а не вмешиваться.",
"Малые шаги сегодня приведут к большим изменениям завтра.",
"Сегодня можно позволить себе странные привычки и радости.",
"Доверие к себе сегодня принесёт удивительные результаты.",
"Сегодня день для лёгких ошибок и смеха над собой.",
"Лучшее решение — действовать мягко, но уверенно.",
"Сегодня можно веселиться даже среди важных дел.",
"Малые радости сегодня создают большой внутренний комфорт.",
"Сегодня день для наблюдений и случайных вдохновений.",
"Лучше всего сегодня — делать меньше и наслаждаться жизнью.",
"Сегодня легко находить общий язык с разными людьми.",
"Маленькие победы сегодня принесут радость и уверенность.",
"Сегодня день для спокойствия и лёгкой иронии.",
"Лучшее решение — довериться моменту и обстоятельствам.",
"Сегодня можно немного лениться и радоваться простым вещам.",
"Сегодня день для случайных радостей и вдохновения.",
"Малые шаги сегодня формируют большую картину успеха.",
"Сегодня идеально для творчества и новых идей.",
"Лучше всего сегодня — улыбаться и наблюдать за событиями.",
"Сегодня день для маленьких радостей и приятных неожиданностей.",
"Сосредоточенность на простом помогает справиться с хаосом.",
"Сегодня можно позволить себе быть немного странным.",
"Малые ошибки сегодня обернутся полезным опытом.",
"Сегодня день для лёгких шалостей и весёлых историй.",
"Лучшее решение — не торопиться и наслаждаться моментом.",
"Сегодня можно доверять случайностям и внутреннему голосу.",
"Сегодня день для маленьких побед и больших улыбок.",
"Случайные события могут принести неожиданные открытия.",
"Сегодня идеально наблюдать и учиться у происходящего.",
"Малые радости сегодня ценнее больших усилий.",
"Сегодня день для лёгких ошибок и забавных ситуаций.",
"Лучше всего сегодня — сохранять спокойствие и улыбку.",
"Сегодня день для маленьких шалостей и радостных моментов.",
"Сегодня можно позволить себе отдыхать и наслаждаться моментом.",
"Малые шаги сегодня ведут к большим переменам.",
"Сегодня день для наблюдений и лёгкой философии.",
"Лучшее решение — принимать события такими, какие они есть.",
"Сегодня можно быть немного ленивым и гордиться собой.",
"Сегодня день для маленьких побед и весёлых историй.",
"Сосредоточенность на простых вещах сегодня принесёт гармонию.",
"Сегодня лучше наблюдать за миром, а не вмешиваться.",
"Малые радости сегодня делают день ярче и легче.",
"Сегодня день для лёгких шалостей и случайных удовольствий.",
"Лучше всего сегодня — делать меньше, а получать больше.",
"Сегодня можно позволить себе странные привычки и радости.",
"Доверие к себе сегодня приведёт к хорошим решениям.",
"Сегодня день для лёгких ошибок и весёлых моментов.",
"Лучшее решение — действовать мягко и с улыбкой.",
"Сегодня можно веселиться среди важных дел и обязанностей.",
"Малые радости сегодня создают большой внутренний комфорт.",
"Сегодня день для наблюдений и случайных радостей.",
"Лучше всего сегодня — делать меньше и наслаждаться жизнью.",
"Сегодня легко находить общий язык с окружающими.",
"Маленькие победы сегодня принесут радость и уверенность.",
"Сегодня день для спокойствия и лёгкой иронии.",
"Лучшее решение — довериться моменту и обстоятельствам.",
"Сегодня можно немного лениться и радоваться простым вещам.",
"Сегодня день для случайных радостей и вдохновения.",
"Малые шаги сегодня формируют большую картину успеха.",
"Сегодня идеально для творчества и новых идей.",
"Лучше всего сегодня — улыбаться и наблюдать за событиями.",
"Сегодня день для маленьких радостей и приятных неожиданностей.",
"Сосредоточенность на простом помогает справиться с хаосом.",
"Сегодня можно позволить себе быть немного странным.",
"Малые ошибки сегодня обернутся полезным опытом.",
"Сегодня день для лёгких шалостей и весёлых историй.",
"Лучшее решение — не торопиться и наслаждаться моментом.",
"Сегодня можно доверять случайностям и внутреннему голосу.",
"Сегодня день для маленьких побед и больших улыбок.",
"Случайные события могут принести неожиданные открытия.",
"Сегодня идеально наблюдать и учиться у происходящего.",
"Малые радости сегодня ценнее больших усилий.",
"Сегодня день для лёгких ошибок и забавных ситуаций.",
"Лучше всего сегодня — сохранять спокойствие и улыбку.",
"Сегодня день для маленьких шалостей и радостных моментов.",
"Сегодня можно позволить себе отдыхать и наслаждаться моментом.",
"Малые шаги сегодня ведут к большим переменам.",
"Сегодня день для наблюдений и лёгкой философии.",
"Сегодня ваш план — наблюдать и ничего не менять.",
"Лучшее решение — смеяться над собственными мелкими катастрофами.",
"Сегодня можно отложить все важные дела на потом.",
"Лучше всего сегодня делать вид, что всё под контролем.",
"Сегодня день для маленьких радостей и больших улыбок.",
"Не переживайте — ошибки сегодня превратятся в забавные истории.",
"Сегодня идеально ничего не планировать, а просто быть здесь.",
"Сегодня лучше лениться и считать это продуктивным временем.",
"Важные решения лучше оставить для завтрашнего вдохновения.",
"Сегодня вы эксперт по игнорированию несущественных проблем.",
"Лучше всего сегодня делать вид, что заняты делами.",
"Сегодня можно веселиться, даже если окружающие слишком серьёзны.",
"Любая мелочь сегодня выглядит как эпическая победа.",
"Сегодня звёзды советуют медленно и с удовольствием пить чай.",
"Главное сегодня — сохранять спокойствие и лёгкость.",
"Сегодня идеально для случайных радостей и маленьких шалостей.",
"Не пытайтесь всё исправить — день сам разберётся.",
"Сегодня можно просто наблюдать и улыбаться происходящему.",
"Лучшее решение — смеяться над собой и ситуацией вокруг.",
"Сегодня день для маленьких побед и больших радостей.",
"Сегодня можно немного лениться и при этом гордиться собой.",
"Главное сегодня — делать меньше, а получать больше удовольствия.",
"Сегодня идеально наслаждаться процессом, а не результатом.",
"Любое событие сегодня воспринимается как игра.",
"Сегодня день для лёгких ошибок и весёлых ситуаций.",
"Сегодня можно позволить себе быть немного странным.",
"Лучше всего сегодня доверять случайностям и своим инстинктам.",
"Сегодня день для случайных улыбок и неожиданных моментов.",
"Сегодня лучше слушать себя, а не чужие советы.",
"Сегодня можно весело игнорировать срочные задачи.",
"Лучшее решение — иногда просто посмеяться над собой.",
"Сегодня можно ничего не делать и считать это успехом.",
"Сегодня день для забавных решений и неожиданных радостей.",
"Не торопитесь — сегодня важнее наслаждаться процессом.",
"Сегодня можно позволить себе маленькие шалости и радости.",
"Лучше всего сегодня смотреть на мир с лёгкой иронией.",
"Сегодня день для случайных улыбок и неожиданных моментов.",
"Сегодня можно быть немного ленивым и гордиться этим.",
"Сегодня лучше слушать себя, а не чужие советы.",
"Любое событие сегодня можно воспринимать как игру.",
"Сегодня день для маленьких радостей и большого веселья.",
"Сегодня лучше наслаждаться моментом и не спешить.",
"Сегодня можно позволить себе маленькие странности и слабости.",
"Сегодня день для лёгких ошибок и весёлых ситуаций.",
"Сегодня идеально день провести, делая совсем немного.",
"Лучше всего сегодня смеяться над собой и происходящим вокруг.",
"Сегодня ваш успех — это вовремя заметить свои ошибки.",
"Сегодня лучше не стараться, а просто плыть по течению.",
"Любые неприятности сегодня будут казаться смешными.",
"Сегодня день для маленьких удовольствий и больших улыбок.",
"Лучше всего сегодня ничего не менять в привычном ритме.",
"Сегодня идеально день провести за любимым хобби и чаем.",
"Сегодня можно лениться и считать это полезным опытом.",
"Любое действие сегодня воспринимается как творческий эксперимент.",
"Сегодня день для наблюдения, а не вмешательства.",
"Сегодня идеально отдыхать и никуда не спешить.",
"Сегодня ваши ошибки будут выглядеть как гениальные идеи.",
"Сегодня день для маленьких шалостей и больших улыбок.",
"Сегодня лучше смеяться, чем искать смысл в хаосе.",
"Сегодня можно позволить себе быть немного эгоистичным.",
"Лучшее решение — не планировать, а наслаждаться процессом.",
"Сегодня день для лёгкого безделья с пользой для души.",
"Сегодня идеально слушать музыку и делать вид, что работаете.",
"Сегодня лучше доверять случайностям и внутреннему голосу.",
"Сегодня день для смешных ошибок и неожиданных открытий.",
"Сегодня можно лениться и считать это мастерством расслабления.",
"Сегодня лучше не напрягаться и идти по течению.",
"Любые мелкие неприятности сегодня легко игнорируются.",
"Сегодня день для случайных радостей и маленьких приключений.",
"Сегодня можно делать вид, что всё под контролем.",
"Сегодня лучше отдыхать и получать удовольствие от момента.",
"Сегодня день для небольших шалостей и весёлых ситуаций.",
"Сегодня можно медленно делать всё и наслаждаться процессом.",
"Лучшее решение — не торопиться и сохранять лёгкость.",
"Сегодня день для маленьких побед и большого удовольствия.",
"Сегодня можно позволить себе странные привычки и радости.",
"Сегодня идеально день провести в расслабленном состоянии.",
"Сегодня лучше смеяться над собой и происходящим вокруг.",
"Сегодня день для небольших радостей и весёлых историй.",
"Сегодня можно позволить себе маленькую лень с достоинством.",
"Сегодня идеально наблюдать за миром, не вмешиваясь ни в что.",
"Сегодня день для лёгких ошибок и смеха над собой.",
"Сегодня можно делать вид, что работаете, пока никто не видит.",
"Сегодня лучше отдыхать и просто наслаждаться моментом.",
"Сегодня день для маленьких шалостей и смешных решений.",
"Сегодня можно немного лениться и чувствовать себя героем.",
"Сегодня день для весёлого игнорирования срочных задач.",
"Сегодня лучше делать меньше и радоваться каждому моменту.",
"Сегодня идеально доверять случайностям и своей интуиции.",
"Сегодня день для небольших радостей и случайных улыбок.",
"Сегодня можно позволить себе лёгкую странность и радость.",
"Сегодня день для маленьких побед и весёлых открытий.",
"Сегодня лучше смеяться над собой и миром вокруг.",
"Сегодня день для безделья с пользой для настроения.",
"Сегодня можно позволить себе быть немного ленивым.",
"Сегодня идеально наблюдать за событиями и улыбаться.",
"Сегодня день для лёгких шалостей и случайных радостей.",
"Сегодня можно позволить себе маленькую лень с удовольствием.",
"Сегодня день для наблюдения и лёгкой иронии.",
"Сегодня лучше доверять себе и внутреннему голосу.",
"Сегодня день для смеха, радости и простых удовольствий.",
"Сегодня можно делать всё медленно и с наслаждением.",
"Сегодня день для маленьких побед и больших улыбок.",
"Сегодня лучше позволить себе немного расслабиться.",
"Сегодня день для лёгких ошибок и весёлых ситуаций.",
"Сегодня можно наслаждаться процессом без лишнего давления.",
"Сегодня день для забавных решений и случайных радостей.",
"Сегодня лучше смеяться над своими неудачами.",
"Сегодня день для маленьких шалостей и больших радостей.",
"Сегодня можно позволить себе лениться с удовольствием.",
"Сегодня день для случайных радостей и весёлых открытий.",
"Сегодня лучше наблюдать за миром и улыбаться.",
"Сегодня день для лёгких ошибок и весёлого настроения.",
"Сегодня можно позволить себе быть немного странным.",
"Сегодня день для маленьких радостей и большого веселья.",
"Сегодня лучше наслаждаться моментом и не торопиться.",
"Сегодня день для лёгких шалостей и весёлых историй.",
"Сегодня можно позволить себе немного лениться и радоваться.",
"Сегодня день для наблюдений, улыбок и небольших побед.",
"Сегодня лучше доверять случайностям и внутреннему голосу.",
"Сегодня день для смеха и маленьких радостей.",
"Сегодня можно делать всё медленно и с удовольствием.",
"Сегодня день для маленьких побед и весёлых моментов.",
"Сегодня лучше позволить себе отдыхать и радоваться.",
    "Сегодня снова играете в любимую игру «сделаю всё в последний момент».",
    "Вы будете счастливее других, но лучше держите это при себе.",
    "Сегодня поймёте простую истину: важно не количество дел, а умение их все не сделать.",
    "Мы бы сказали не париться по пустякам, но вы от этого прям кайфуете.",
    "Сегодня можно откладывать дела не просто на завтра, а на десять лет.",
    "Лучше всего сегодня ничего не менять, даже привычные ошибки сохраняйте.",
    "Сегодня вы убедитесь, что кофе решает почти все жизненные проблемы.",
    "Ваш план на день — переждать, пока всё само собой наладится.",
    "Сегодня идеально день провести в медитации или на диване.",
    "Лучше всего сегодня слушать музыку и делать вид, что работаете.",
    "Важные решения лучше отложить, пока не появится вдохновение случайно.",
    "Сегодня звёзды советуют улыбаться, даже если понимаете, что это бессмысленно.",
    "Сохраняйте спокойствие: окружающие тоже не знают, что делают.",
    "Сегодня ваша главная победа — это вовремя найти носки.",
    "Не переживайте: ошибки, которые вы совершите, станут легендой.",
    "Лучше отложить дела на завтра — а потом на послезавтра.",
    "Сегодня вы станете мастером игнорирования мелких неприятностей.",
    "Занимайтесь тем, что приносит радость, а остальное само собой решится.",
    "Сегодня ваш девиз — меньше делать, больше наслаждаться процессом.",
    "Если что-то идёт не так, притворяйтесь, что это было частью плана.",
    "Сегодня отличное время для откладывания всех важных разговоров.",
    "Не спешите никуда — мир подождёт, пока вы спите.",
    "Сегодня можно быть ленивым и гордиться этим достижением.",
    "Ваша интуиция подскажет, что лучше вообще ничего не делать.",
    "Сегодня звёзды рекомендуют немного прокрастинировать с удовольствием.",
    "Лучше всего сегодня делать вид, что вы всё контролируете.",
    "Сегодня вы поймёте, что перфекционизм — враг вашего отдыха.",
    "Не пытайтесь быть идеальными — хватит просто быть живыми.",
    "Сегодня день для маленьких радостей и больших отговорок.",
    "Любые трудности сегодня легко решаются игнорированием их существования.",
    "Сегодня лучше отложить звонки и писать сообщения мысленно.",
    "Всё, что вы сегодня забудете, будет выглядеть как шутка судьбы.",
    "Сегодня можно делать вид, что работаете, пока никто не видит.",
    "Главное сегодня — сохранять лицо, даже если внутри хаос.",
    "Лучше всего сегодня наблюдать за миром, не вмешиваясь ни в что.",
    "Сегодня вы убедитесь, что смех действительно продлевает жизнь.",
    "Любое решение можно отложить на завтра — и это нормально.",
    "Сегодня ваш талант — делать вид, что всё под контролем.",
    "Лучшее время для вдохновения — когда никто не ждёт от вас результата.",
    "Сегодня идеально планировать что-то, что никогда не будет выполнено.",
    "Не парьтесь по пустякам — они сами скоро надоедят.",
    "Сегодня можно быть немного странным и гордиться этим.",
    "Лучше всего сегодня расслабиться и смотреть, как течёт день.",
    "Сегодня вы эксперт по откладыванию дел с минимальными потерями.",
    "Любое приключение можно начать завтра — и это будет нормально.",
    "Сегодня отличный день, чтобы пересматривать старые фото и улыбаться.",
    "Лучше отдохнуть, чем пытаться что-то кардинально изменить.",
    "Сегодня вы поймёте, что иногда ничего не делание — лучший план.",
    "Маленькие радости сегодня гораздо важнее больших усилий.",
    "Сегодня можно наслаждаться процессом, а не результатом.",
    "Ваш внутренний мир сегодня важнее внешних обязательств.",
    "Сегодня можно смело игнорировать срочные задачи — они подождут.",
    "Лучше всего сегодня смеяться над собой и ситуацией вокруг.",
    "Сегодня ваш успех — это вовремя заметить свои ошибки и забыть их.",
    "Не пытайтесь быть полезным всем — хватит быть собой.",
    "Сегодня идеально день провести в тёплом пледе с чаем.",
    "Лучшее решение — иногда просто притворяться, что вы заняты.",
    "Сегодня можно позволить себе забыть про все дедлайны.",
    "Не принимайте ничего всерьёз — кроме удовольствия от дня.",
    "Сегодня вы мастер прокрастинации с чувством стиля.",
    "Любое разочарование сегодня можно превратить в забавную историю.",
    "Сегодня мир ждёт, пока вы поймёте, что делать не нужно.",
    "Лучше всего сегодня наблюдать, а не вмешиваться.",
    "Сегодня вы откроете секрет: иногда отдых важнее работы.",
    "Любые трудности сегодня кажутся смешными, если их игнорировать.",
    "Сегодня день для лёгкости, улыбок и минимальных усилий.",
    "Главное сегодня — сохранять спокойствие и внутреннюю гармонию.",
    "Сегодня можно делать всё медленно и с удовольствием.",
    "Не торопитесь — сегодня время на вашей стороне.",
    "Сегодня вы будете экспертами по маленьким радостям.",
    "Лучшее решение — иногда просто отложить всё на завтра.",
    "Сегодня день для забавных ошибок и лёгкого отношения к ним.",
    "Сегодня можно смеяться над тем, что обычно раздражает.",
    "Главное сегодня — делать меньше, а получать больше удовольствия.",
    "Сегодня можно наслаждаться тем, что идёт не так, как планировали.",
    "Лучше всего сегодня позволять себе маленькие слабости.",
    "Сегодня день для случайных радостей и неожиданных находок.",
    "Сегодня вы поймёте, что иногда бездействие — лучший план.",
    "Любое маленькое достижение сегодня будет выглядеть как победа.",
    "Сегодня можно быть ленивым с чувством собственного достоинства.",
    "Лучше всего сегодня не планировать, а наслаждаться моментом.",
    "Сегодня можно смеяться над всеми правилами и порядками.",
    "Не пытайтесь всё исправить — день сам всё расставит.",
    "Сегодня идеально день провести без лишних обязательств.",
    "Лучше всего сегодня ценить маленькие удовольствия и простые радости.",
    "Сегодня можно просто наблюдать за миром и улыбаться.",
    "Любое дело сегодня лучше сделать с юмором и лёгкостью.",
    "Сегодня вы станете мастером лёгкой жизни и простых решений.",
    "Сегодня можно позволить себе быть немного странным.",
    "Лучше всего сегодня доверять случайностям и своим инстинктам.",
    "Сегодня день для маленьких побед и больших улыбок.",
    "Сегодня можно весело игнорировать срочные задачи.",
    "Лучшее решение — иногда просто посмеяться над собой.",
    "Сегодня можно ничего не делать и считать это успехом.",
    "Сегодня день для забавных решений и неожиданных радостей.",
    "Не торопитесь — сегодня важнее наслаждаться процессом.",
    "Сегодня можно позволить себе маленькие шалости и радости.",
    "Лучше всего сегодня смотреть на мир с лёгкой иронией.",
    "Сегодня день для случайных улыбок и неожиданных моментов.",
    "Сегодня можно быть немного ленивым и гордиться этим.",
    "Сегодня лучше слушать себя, а не чужие советы.",
    "Любое событие сегодня можно воспринимать как игру.",
    "Сегодня день для маленьких радостей и большого веселья.",
    "Сегодня лучше наслаждаться моментом и не спешить.",
    "Сегодня можно позволить себе маленькие странности и слабости.",
    "Сегодня день для лёгких ошибок и весёлых ситуаций.",
    "Сегодня идеально день провести, делая совсем немного.",
    "Лучше всего сегодня смеяться над собой и происходящим вокруг."
]


# --- Работа с историей ---
def load_history():
    if not os.path.exists(HISTORY_FILE):
        return set()
    try:
        with open(HISTORY_FILE, "r", encoding="utf-8") as f:
            raw = json.load(f)
        cutoff = datetime.now() - timedelta(days=HISTORY_DAYS)
        return {tuple(item["combo"]) for item in raw if datetime.fromisoformat(item["date"]) > cutoff}
    except Exception:
        return set()

def save_history(history):
    try:
        data = [{"combo": list(c), "date": datetime.now().isoformat()} for c in history]
        with open(HISTORY_FILE, "w", encoding="utf-8") as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
    except Exception:
        pass

used_combinations = load_history()

def generate_unique_combo():
    for _ in range(4000):
        prediction = random.choice(predictions)  # теперь берем готовую фразу из массива
        card = random.choice(tarot_cards)
        focus = random.choice(focus_options)
        combo = (prediction, card, focus)
        if combo not in used_combinations:
            used_combinations.add(combo)
            save_history(used_combinations)
            return prediction, card, focus
    # если вдруг исчерпали уникальные — очистим историю
    used_combinations.clear()
    save_history(used_combinations)
    return generate_unique_combo()

# --- Проверка доступа ---
def assert_channel_access():
    try:
        bot.get_chat(CHANNEL_ID)
    except Exception as e:
        raise SystemExit(f"❌ Ошибка доступа к каналу: {e}\nПроверь ID и права бота (бот должен быть админом).")

# --- Формат даты ---
def russian_date():
    now = datetime.now()
    return f"{now.day} {MONTHS[now.month]}"

# --- Главная отправка ---
def main():
    print("Проверяю доступ к каналу...")
    assert_channel_access()
    print("✅ Доступ есть. Начинаю отправку...")

    for sign in signs:
        prediction, card, focus = generate_unique_combo()
        sign_name = sign.split(" ")[1]  # например "Овен"
        date_str = russian_date()
        compatibility_text = compatibility.get(sign_name, "—")

        text = (
            f"{sign}, {date_str}\n\n"
            f"💡 Прогноз: {prediction}\n\n"
            f"🎴 Карта дня: {card}\n\n"
            f"🎯 Фокус дня: {focus}\n"
            f"💞 Совместимость: {compatibility_text}\n\n"
            f"🔮 <a href=\"https://t.me/+QIQFGYWwkLhiYjFi\">Научный гороскоп</a>"
        )

        try:
            bot.send_message(CHANNEL_ID, text, parse_mode="HTML", disable_web_page_preview=True)
            print(f"✔ {sign} — отправлено. Карта: {card} | Фокус: {focus}")
        except Exception as e:
            print(f"❌ Ошибка при {sign}: {e}")

        if SLEEP_SECONDS > 0:
            time.sleep(SLEEP_SECONDS)

    print("🎉 Готово — все гороскопы отправлены.")

if __name__ == "__main__":
    main()
