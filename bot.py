import os
import telebot
import random
import time
import json
from datetime import datetime, timedelta

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ---
BOT_TOKEN = os.getenv("BOT_TOKEN") or os.getenv("TELEGRAM_TOKEN")
CHANNEL_ID = os.getenv("CHANNEL_ID")  # "@my_channel" –∏–ª–∏ "-1001234567890"
SLEEP_SECONDS = int(os.getenv("SLEEP_SECONDS", "180"))  # –ø–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ—Å—Ç–∞–º–∏
HISTORY_FILE = "used_combinations.json"
HISTORY_DAYS = int(os.getenv("HISTORY_DAYS", "30"))

if not BOT_TOKEN:
    raise SystemExit("‚ùå –û—à–∏–±–∫–∞: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è BOT_TOKEN (–∏–ª–∏ TELEGRAM_TOKEN) –Ω–µ –∑–∞–¥–∞–Ω–∞.")
if not CHANNEL_ID:
    raise SystemExit("‚ùå –û—à–∏–±–∫–∞: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è CHANNEL_ID –Ω–µ –∑–∞–¥–∞–Ω–∞.")

bot = telebot.TeleBot(BOT_TOKEN)

# --- –ú–µ—Å—è—Ü—ã –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã ---
MONTHS = {
    1: "—è–Ω–≤–∞—Ä—è", 2: "—Ñ–µ–≤—Ä–∞–ª—è", 3: "–º–∞—Ä—Ç–∞", 4: "–∞–ø—Ä–µ–ª—è",
    5: "–º–∞—è", 6: "–∏—é–Ω—è", 7: "–∏—é–ª—è", 8: "–∞–≤–≥—É—Å—Ç–∞",
    9: "—Å–µ–Ω—Ç—è–±—Ä—è", 10: "–æ–∫—Ç—è–±—Ä—è", 11: "–Ω–æ—è–±—Ä—è", 12: "–¥–µ–∫–∞–±—Ä—è"
}

# --- –§—Ä–∞–∑—ã ---
start_phrases = [
    "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å,", "–í —ç—Ç–æ—Ç –¥–µ–Ω—å –ø—Ä–æ—è–≤–∏—Ç—Å—è —Ç–µ–Ω–¥–µ–Ω—Ü–∏—è, —á—Ç–æ",
    "–≠–Ω–µ—Ä–≥–∏–∏ —Å—É—Ç–æ–∫ –¥–∞—é—Ç —Å–∏–≥–Ω–∞–ª –æ —Ç–æ–º,", "–ù–∞—Å—Ç—É–ø–∞—é—â–∏–π –¥–µ–Ω—å –ø—Ä–∏–Ω–µ—Å—ë—Ç –æ—â—É—â–µ–Ω–∏–µ, —á—Ç–æ",
    "–° —Å–∞–º–æ–≥–æ —É—Ç—Ä–∞ —Å—Ç–∞–Ω–µ—Ç —è—Å–Ω–æ,", "–°—É–¥—å–±–∞ –º—è–≥–∫–æ –Ω–∞–ø–æ–º–Ω–∏—Ç —Ç–µ–±–µ, —á—Ç–æ",
    "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–π –ø–æ–¥—Å–∫–∞–∂–µ—Ç, —á—Ç–æ", "–°–ª—É—á–∞–π–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –¥–∞–¥—É—Ç –ø–æ–Ω—è—Ç—å, —á—Ç–æ",
    "–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —É–∫–∞–∂–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ,", "–°–∞–º–∞ –í—Å–µ–ª–µ–Ω–Ω–∞—è —É–∫–∞–∂–µ—Ç, —á—Ç–æ",
]

middle_phrases = [
    "–≤–∞–∂–Ω–æ –ø—Ä–∏—Å–ª—É—à–∞—Ç—å—Å—è –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –≥–æ–ª–æ—Å—É,", "—Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –ª–∏—á–Ω—ã—Ö —Ü–µ–ª—è—Ö,",
    "–Ω—É–∂–Ω–æ —É–¥–µ–ª–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –¥–µ—Ç–∞–ª—è–º,", "–ª—É—á—à–µ –¥–æ–≤–µ—Ä–∏—Ç—å—Å—è –ø—Ä–æ—Ü–µ—Å—Å—É,",
    "—Ö–æ—Ä–æ—à–æ –±—ã –Ω–∞–ø—Ä–∞–≤–∏—Ç—å —É—Å–∏–ª–∏—è –≤ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ,", "—Å–ª–µ–¥—É–µ—Ç —É–¥–µ–ª–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—é,",
    "–≤–∞–∂–Ω–æ –∏–∑–±–µ–≥–∞—Ç—å –ø–æ—Å–ø–µ—à–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π,", "–º–æ–∂–Ω–æ –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞,",
    "—Å—Ç–æ–∏—Ç –ø—Ä–æ—è–≤–∏—Ç—å —Ç–µ—Ä–ø–µ–Ω–∏–µ,", "–ª—É—á—à–µ —É–¥–µ–ª–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ —Å–µ–º—å–µ –∏ –¥–æ–º—É,"
]

end_phrases = [
    "–∏ —ç—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.", "—á—Ç–æ —Ä–∞—Å–∫—Ä–æ–µ—Ç –Ω–æ–≤—ã–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã.",
    "–≤–µ–¥—è —Ç–µ–±—è –∫ –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ —É—Å–ø–µ—Ö—É.", "–∏ –ø–æ–¥–∞—Ä–∏—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –æ—Ç–∫—Ä—ã—Ç–∏—è.",
    "–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–¥–∏–≤–∏—Ç —Ç–µ–±—è.", "–¥–∞—Ä—è –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –∏ —Å–∏–ª—ã.",
    "–∏ —ç—Ç–æ —É–∫—Ä–µ–ø–∏—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ.", "–æ—Ç–∫—Ä–æ–µ—Ç –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã."
]

# --- –ö–æ–ª–æ–¥–∞ —Ç–∞—Ä–æ (78 –∫–∞—Ä—Ç) ---
tarot_cards = [
    "–®—É—Ç ‚Äî –Ω–æ–≤—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è, —Å–≤–æ–±–æ–¥–∞", "–ú–∞–≥ ‚Äî —Å–∏–ª–∞ –≤–æ–ª–∏, –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ", "–í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞ ‚Äî –∏–Ω—Ç—É–∏—Ü–∏—è, —Ç–∞–π–Ω—ã",
    "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞ ‚Äî –∏–∑–æ–±–∏–ª–∏–µ, –∑–∞–±–æ—Ç–∞", "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä ‚Äî –ø–æ—Ä—è–¥–æ–∫, –≤–ª–∞—Å—Ç—å", "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç ‚Äî —Ç—Ä–∞–¥–∏—Ü–∏–∏, –æ–±—É—á–µ–Ω–∏–µ",
    "–í–ª—é–±–ª—ë–Ω–Ω—ã–µ ‚Äî –≤—ã–±–æ—Ä, –≥–∞—Ä–º–æ–Ω–∏—è", "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞ ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ, –ø–æ–±–µ–¥–∞", "–°–∏–ª–∞ ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç–æ–π–∫–æ—Å—Ç—å, –º—É–∂–µ—Å—Ç–≤–æ",
    "–û—Ç—à–µ–ª—å–Ω–∏–∫ ‚Äî –ø–æ–∏—Å–∫ –∏—Å—Ç–∏–Ω—ã, —É–µ–¥–∏–Ω–µ–Ω–∏–µ", "–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã ‚Äî –ø–µ—Ä–µ–º–µ–Ω—ã, —Å—É–¥—å–±–∞", "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å ‚Äî –±–∞–ª–∞–Ω—Å, —á–µ—Å—Ç–Ω–æ—Å—Ç—å",
    "–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π ‚Äî –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞, –Ω–æ–≤—ã–µ –≤–∑–≥–ª—è–¥—ã", "–°–º–µ—Ä—Ç—å ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –∫–æ–Ω–µ—Ü –∏ –Ω–∞—á–∞–ª–æ", "–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –≥–∞—Ä–º–æ–Ω–∏—è, —Ç–µ—Ä–ø–µ–Ω–∏–µ",
    "–î—å—è–≤–æ–ª ‚Äî –∏—Å–∫—É—à–µ–Ω–∏—è, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏", "–ë–∞—à–Ω—è ‚Äî —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ", "–ó–≤–µ–∑–¥–∞ ‚Äî –Ω–∞–¥–µ–∂–¥–∞, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ",
    "–õ—É–Ω–∞ ‚Äî –∏–ª–ª—é–∑–∏–∏, —Å–Ω—ã", "–°–æ–ª–Ω—Ü–µ ‚Äî —Ä–∞–¥–æ—Å—Ç—å, —É—Å–ø–µ—Ö", "–°—É–¥ ‚Äî –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ, –≤–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ", "–ú–∏—Ä ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å",
    # –ú–∞—Å—Ç—å –ñ–µ–∑–ª–æ–≤
    "–¢—É–∑ –ñ–µ–∑–ª–æ–≤ ‚Äî —ç–Ω–µ—Ä–≥–∏—è, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏", "–î–≤–æ–π–∫–∞ –ñ–µ–∑–ª–æ–≤ ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤—ã–±–æ—Ä", "–¢—Ä–æ–π–∫–∞ –ñ–µ–∑–ª–æ–≤ ‚Äî –æ–∂–∏–¥–∞–Ω–∏—è, –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã",
    "–ß–µ—Ç–≤—ë—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤ ‚Äî –ø—Ä–∞–∑–¥–Ω–∏–∫, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å", "–ü—è—Ç—ë—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤ ‚Äî –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è, –≤—ã–∑–æ–≤", "–®–µ—Å—Ç—ë—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤ ‚Äî –ø–æ–±–µ–¥–∞, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ",
    "–°–µ–º—ë—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤ ‚Äî –∑–∞—â–∏—Ç–∞, —É–ø–æ—Ä—Å—Ç–≤–æ", "–í–æ—Å—å–º—ë—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤ ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å, –Ω–æ–≤–æ—Å—Ç–∏", "–î–µ–≤—è—Ç–∫–∞ –ñ–µ–∑–ª–æ–≤ ‚Äî —Å—Ç–æ–π–∫–æ—Å—Ç—å, –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ",
    "–î–µ—Å—è—Ç–∫–∞ –ñ–µ–∑–ª–æ–≤ ‚Äî —Ç—è–∂–µ—Å—Ç—å, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "–ü–∞–∂ –ñ–µ–∑–ª–æ–≤ ‚Äî —ç–Ω—Ç—É–∑–∏–∞–∑–º, –Ω–∞—á–∞–ª–æ", "–†—ã—Ü–∞—Ä—å –ñ–µ–∑–ª–æ–≤ ‚Äî —Ä–µ—à–∏–º–æ—Å—Ç—å, –¥–≤–∏–∂–µ–Ω–∏–µ",
    "–ö–æ—Ä–æ–ª–µ–≤–∞ –ñ–µ–∑–ª–æ–≤ ‚Äî —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ", "–ö–æ—Ä–æ–ª—å –ñ–µ–∑–ª–æ–≤ ‚Äî –ª–∏–¥–µ—Ä—Å—Ç–≤–æ, —Å–∏–ª–∞",
    # –ú–∞—Å—Ç—å –ö—É–±–∫–æ–≤
    "–¢—É–∑ –ö—É–±–∫–æ–≤ ‚Äî —ç–º–æ—Ü–∏–∏, –ª—é–±–æ–≤—å", "–î–≤–æ–π–∫–∞ –ö—É–±–∫–æ–≤ ‚Äî —Å–æ—é–∑, –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ", "–¢—Ä–æ–π–∫–∞ –ö—É–±–∫–æ–≤ ‚Äî —Ä–∞–¥–æ—Å—Ç—å, –¥—Ä—É–∑—å—è",
    "–ß–µ—Ç–≤—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤ ‚Äî —Å–∫—É–∫–∞, –Ω–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ", "–ü—è—Ç—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤ ‚Äî —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ—Ç–µ—Ä—è", "–®–µ—Å—Ç—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤ ‚Äî –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è, –ø—Ä–æ—à–ª–æ–µ",
    "–°–µ–º—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤ ‚Äî –∏–ª–ª—é–∑–∏–∏, –≤—ã–±–æ—Ä", "–í–æ—Å—å–º—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤ ‚Äî —É—Ö–æ–¥, –ø–æ–∏—Å–∫ —Å–º—ã—Å–ª–∞", "–î–µ–≤—è—Ç–∫–∞ –ö—É–±–∫–æ–≤ ‚Äî —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ, –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",
    "–î–µ—Å—è—Ç–∫–∞ –ö—É–±–∫–æ–≤ ‚Äî –≥–∞—Ä–º–æ–Ω–∏—è, —Å–µ–º—å—è", "–ü–∞–∂ –ö—É–±–∫–æ–≤ ‚Äî –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, —á—É–≤—Å—Ç–≤–∞", "–†—ã—Ü–∞—Ä—å –ö—É–±–∫–æ–≤ ‚Äî —Ä–æ–º–∞–Ω—Ç–∏–∫–∞, –º–µ—á—Ç—ã",
    "–ö–æ—Ä–æ–ª–µ–≤–∞ –ö—É–±–∫–æ–≤ ‚Äî —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–ö–æ—Ä–æ–ª—å –ö—É–±–∫–æ–≤ ‚Äî –∑—Ä–µ–ª–æ—Å—Ç—å, –±–∞–ª–∞–Ω—Å",
    # –ú–∞—Å—Ç—å –ú–µ—á–µ–π
    "–¢—É–∑ –ú–µ—á–µ–π ‚Äî –∏—Å—Ç–∏–Ω–∞, —è—Å–Ω–æ—Å—Ç—å", "–î–≤–æ–π–∫–∞ –ú–µ—á–µ–π ‚Äî –≤—ã–±–æ—Ä, —Å–æ–º–Ω–µ–Ω–∏—è", "–¢—Ä–æ–π–∫–∞ –ú–µ—á–µ–π ‚Äî –±–æ–ª—å, —Ä–∞–∑—Ä—ã–≤",
    "–ß–µ—Ç–≤—ë—Ä–∫–∞ –ú–µ—á–µ–π ‚Äî –æ—Ç–¥—ã—Ö, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ", "–ü—è—Ç—ë—Ä–∫–∞ –ú–µ—á–µ–π ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç, –ø–æ—Ä–∞–∂–µ–Ω–∏–µ", "–®–µ—Å—Ç—ë—Ä–∫–∞ –ú–µ—á–µ–π ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä—ë–¥",
    "–°–µ–º—ë—Ä–∫–∞ –ú–µ—á–µ–π ‚Äî —Ö–∏—Ç—Ä–æ—Å—Ç—å, –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å", "–í–æ—Å—å–º—ë—Ä–∫–∞ –ú–µ—á–µ–π ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —Å—Ç—Ä–∞—Ö", "–î–µ–≤—è—Ç–∫–∞ –ú–µ—á–µ–π ‚Äî —Ç—Ä–µ–≤–æ–≥–∞, –∫–æ—à–º–∞—Ä—ã",
    "–î–µ—Å—è—Ç–∫–∞ –ú–µ—á–µ–π ‚Äî –∫–æ–Ω–µ—Ü, –ø–æ—Ä–∞–∂–µ–Ω–∏–µ", "–ü–∞–∂ –ú–µ—á–µ–π ‚Äî –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ, –∏–¥–µ–∏", "–†—ã—Ü–∞—Ä—å –ú–µ—á–µ–π ‚Äî –Ω–∞–ø–æ—Ä, –∏–º–ø—É–ª—å—Å",
    "–ö–æ—Ä–æ–ª–µ–≤–∞ –ú–µ—á–µ–π ‚Äî –º—É–¥—Ä–æ—Å—Ç—å, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å", "–ö–æ—Ä–æ–ª—å –ú–µ—á–µ–π ‚Äî —Ä–∞—Å—Å—É–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ª–æ–≥–∏–∫–∞",
    # –ú–∞—Å—Ç—å –ü–µ–Ω—Ç–∞–∫–ª–µ–π
    "–¢—É–∑ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –±–ª–∞–≥–∞", "–î–≤–æ–π–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî –±–∞–ª–∞–Ω—Å, –∞–¥–∞–ø—Ç–∞—Ü–∏—è", "–¢—Ä–æ–π–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ",
    "–ß–µ—Ç–≤—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî —É–¥–µ—Ä–∂–∞–Ω–∏–µ, –∫–æ–Ω—Ç—Ä–æ–ª—å", "–ü—è—Ç—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏, –ª–∏—à–µ–Ω–∏—è", "–®–µ—Å—Ç—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî –ø–æ–º–æ—â—å, —â–µ–¥—Ä–æ—Å—Ç—å",
    "–°–µ–º—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî —Ç–µ—Ä–ø–µ–Ω–∏–µ, –æ–∂–∏–¥–∞–Ω–∏–µ", "–í–æ—Å—å–º—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî —Ä–∞–±–æ—Ç–∞, –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ", "–î–µ–≤—è—Ç–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî —É—Å–ø–µ—Ö, —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å",
    "–î–µ—Å—è—Ç–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî –±–æ–≥–∞—Ç—Å—Ç–≤–æ, —Å–µ–º—å—è", "–ü–∞–∂ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî —É—á–µ–±–∞, –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å", "–†—ã—Ü–∞—Ä—å –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å, —Ç—Ä—É–¥–æ–ª—é–±–∏–µ",
    "–ö–æ—Ä–æ–ª–µ–≤–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî –∑–∞–±–æ—Ç–∞, —É—é—Ç", "–ö–æ—Ä–æ–ª—å –ü–µ–Ω—Ç–∞–∫–ª–µ–π ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –¥–æ—Å—Ç–∞—Ç–æ–∫"
]

# --- –ó–Ω–∞–∫–∏ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å ---
signs = [
    "‚ôàÔ∏è –û–≤–µ–Ω", "‚ôâÔ∏è –¢–µ–ª–µ—Ü", "‚ôäÔ∏è –ë–ª–∏–∑–Ω–µ—Ü—ã", "‚ôãÔ∏è –†–∞–∫",
    "‚ôåÔ∏è –õ–µ–≤", "‚ôçÔ∏è –î–µ–≤–∞", "‚ôéÔ∏è –í–µ—Å—ã", "‚ôèÔ∏è –°–∫–æ—Ä–ø–∏–æ–Ω",
    "‚ôêÔ∏è –°—Ç—Ä–µ–ª–µ—Ü", "‚ôëÔ∏è –ö–æ–∑–µ—Ä–æ–≥", "‚ôíÔ∏è –í–æ–¥–æ–ª–µ–π", "‚ôìÔ∏è –†—ã–±—ã"
]

compatibility = {
    "–û–≤–µ–Ω": "–õ–µ–≤, –°—Ç—Ä–µ–ª–µ—Ü", "–¢–µ–ª–µ—Ü": "–î–µ–≤–∞, –ö–æ–∑–µ—Ä–æ–≥", "–ë–ª–∏–∑–Ω–µ—Ü—ã": "–í–µ—Å—ã, –í–æ–¥–æ–ª–µ–π",
    "–†–∞–∫": "–°–∫–æ—Ä–ø–∏–æ–Ω, –†—ã–±—ã", "–õ–µ–≤": "–û–≤–µ–Ω, –°—Ç—Ä–µ–ª–µ—Ü", "–î–µ–≤–∞": "–¢–µ–ª–µ—Ü, –ö–æ–∑–µ—Ä–æ–≥",
    "–í–µ—Å—ã": "–ë–ª–∏–∑–Ω–µ—Ü—ã, –í–æ–¥–æ–ª–µ–π", "–°–∫–æ—Ä–ø–∏–æ–Ω": "–†–∞–∫, –†—ã–±—ã", "–°—Ç—Ä–µ–ª–µ—Ü": "–û–≤–µ–Ω, –õ–µ–≤",
    "–ö–æ–∑–µ—Ä–æ–≥": "–¢–µ–ª–µ—Ü, –î–µ–≤–∞", "–í–æ–¥–æ–ª–µ–π": "–ë–ª–∏–∑–Ω–µ—Ü—ã, –í–µ—Å—ã", "–†—ã–±—ã": "–†–∞–∫, –°–∫–æ—Ä–ø–∏–æ–Ω"
}

focus_options = [
    "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞", "–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å", "–¢–≤–æ—Ä—á–µ—Å–∫–æ–µ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ",
    "–û–±—â–µ–Ω–∏–µ –∏ —Å–≤—è–∑–∏", "–°–µ–º–µ–π–Ω–æ–µ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ", "–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç",
    "–î—É—Ö–æ–≤–Ω—ã–π –ø–æ–∏—Å–∫", "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å", "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Å–ø–µ—Ö",
    "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å", "–û—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –¥—Ä—É–∂–±–∞", "–°–º–µ–ª—ã–µ —Ä–µ—à–µ–Ω–∏—è"
]

# --- –†–∞–±–æ—Ç–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π ---
def load_history():
    if not os.path.exists(HISTORY_FILE):
        return set()
    try:
        with open(HISTORY_FILE, "r", encoding="utf-8") as f:
            raw = json.load(f)
        cutoff = datetime.now() - timedelta(days=HISTORY_DAYS)
        return {tuple(item["combo"]) for item in raw if datetime.fromisoformat(item["date"]) > cutoff}
    except Exception:
        return set()

def save_history(history):
    data = [{"combo": list(c), "date": datetime.now().isoformat()} for c in history]
    with open(HISTORY_FILE, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

used_combinations = load_history()

# --- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ---
def generate_prediction_text():
    return f"{random.choice(start_phrases)} {random.choice(middle_phrases)} {random.choice(end_phrases)}"

def generate_unique_combo():
    for _ in range(2000):
        prediction = generate_prediction_text()
        card = random.choice(tarot_cards)
        focus = random.choice(focus_options)
        combo = (prediction, card, focus)
        if combo not in used_combinations:
            used_combinations.add(combo)
            save_history(used_combinations)
            return prediction, card, focus
    used_combinations.clear()
    save_history(used_combinations)
    return generate_unique_combo()

# --- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ ---
def assert_channel_access():
    try:
        bot.get_chat(CHANNEL_ID)
    except Exception as e:
        raise SystemExit(f"‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–Ω–∞–ª—É: {e}\n–ü—Ä–æ–≤–µ—Ä—å ID –∏ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞.")

# --- –§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã ---
def russian_date():
    now = datetime.now()
    return f"{now.day} {MONTHS[now.month]}"

# --- –ì–ª–∞–≤–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ ---
def main():
    print("–ü—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø –∫ –∫–∞–Ω–∞–ª—É...")
    assert_channel_access()
    print("‚úÖ –î–æ—Å—Ç—É–ø –µ—Å—Ç—å. –ù–∞—á–∏–Ω–∞—é –æ—Ç–ø—Ä–∞–≤–∫—É...")
    
    for sign in signs:
        prediction, card, focus = generate_unique_combo()
        sign_name = sign.split(" ")[1]  # –Ω–∞–ø—Ä–∏–º–µ—Ä "–û–≤–µ–Ω"
        date_str = russian_date()
        compatibility_text = compatibility.get(sign_name, "‚Äî")
        
        text = (
            f"{sign}, {date_str}\n\n"
            f"üí° –ü—Ä–æ–≥–Ω–æ–∑: {prediction}\n"
            f"üé¥ –ö–∞—Ä—Ç–∞ –¥–Ω—è: {card}\n"
            f"üéØ –§–æ–∫—É—Å –¥–Ω—è: {focus}\n"
            f"üíû –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: {compatibility_text}\n\n"
            f"üîÆ <a href=\"https://t.me/+QIQFGYWwkLhiYjFi\">–ù–∞—É—á–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø</a>"
        )
        
        try:
            bot.send_message(CHANNEL_ID, text, parse_mode="HTML", disable_web_page_preview=True)
            print(f"‚úî {sign} ‚Äî {card} ‚Äî {focus}")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ {sign}: {e}")
        
        if SLEEP_SECONDS > 0:
            time.sleep(SLEEP_SECONDS)
    
    print("üéâ –ì–æ—Ç–æ–≤–æ ‚Äî –≤—Å–µ –≥–æ—Ä–æ—Å–∫–æ–ø—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.")

if __name__ == "__main__":
    main()
